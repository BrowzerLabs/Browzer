<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email Service Configuration - Browzer</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      color: #ffffff;
      min-height: 100vh;
    }

    .config-container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 40px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
    }

    .config-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .config-header h1 {
      font-size: 2rem;
      margin: 0 0 10px 0;
      background: linear-gradient(135deg, #00f5ff, #ff0080);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .config-header p {
      color: rgba(255, 255, 255, 0.7);
      margin: 0;
    }

    .provider-selection {
      margin-bottom: 30px;
    }

    .provider-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .provider-option {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .provider-option:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(0, 245, 255, 0.3);
    }

    .provider-option.selected {
      border-color: rgba(0, 245, 255, 0.6);
      background: rgba(0, 245, 255, 0.1);
    }

    .provider-option h3 {
      margin: 0 0 8px 0;
      font-size: 1.1rem;
    }

    .provider-option p {
      margin: 0;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .config-form {
      display: none;
    }

    .config-form.active {
      display: block;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.9);
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      color: #ffffff;
      font-size: 16px;
      box-sizing: border-box;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: rgba(0, 245, 255, 0.5);
      box-shadow: 0 0 0 3px rgba(0, 245, 255, 0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 120px 100px;
      gap: 16px;
      align-items: end;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #00f5ff, #ff0080);
      color: #ffffff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 245, 255, 0.3);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .btn-test {
      background: rgba(39, 202, 63, 0.2);
      color: #27ca3f;
      border: 1px solid rgba(39, 202, 63, 0.3);
    }

    .btn-test:hover {
      background: rgba(39, 202, 63, 0.3);
    }

    .actions {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin-top: 40px;
    }

    .status-message {
      padding: 12px 16px;
      border-radius: 8px;
      margin-top: 16px;
      font-weight: 500;
    }

    .status-message.success {
      background: rgba(39, 202, 63, 0.1);
      color: #27ca3f;
      border: 1px solid rgba(39, 202, 63, 0.3);
    }

    .status-message.error {
      background: rgba(255, 95, 86, 0.1);
      color: #ff5f56;
      border: 1px solid rgba(255, 95, 86, 0.3);
    }

    .help-text {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="config-container">
    <div class="config-header">
      <h1>Email Service Configuration</h1>
      <p>Configure your email service to enable OTP verification and notifications</p>
    </div>

    <div class="provider-selection">
      <h3>Choose Email Provider</h3>
      <div class="provider-options">
        <div class="provider-option" data-provider="smtp">
          <h3>Custom SMTP</h3>
          <p>Use your own SMTP server</p>
        </div>
        <div class="provider-option" data-provider="sendgrid">
          <h3>SendGrid</h3>
          <p>Popular email API service</p>
        </div>
        <div class="provider-option" data-provider="mailgun">
          <h3>Mailgun</h3>
          <p>Developer-friendly email API</p>
        </div>
        <div class="provider-option" data-provider="resend">
          <h3>Resend</h3>
          <p>Modern email for developers</p>
        </div>
      </div>
    </div>

    <!-- SMTP Configuration -->
    <div class="config-form" id="smtp-config">
      <h3>SMTP Configuration</h3>
      <div class="form-group">
        <label for="smtp-host">SMTP Host</label>
        <input type="text" id="smtp-host" placeholder="smtp.gmail.com">
        <div class="help-text">Your SMTP server hostname</div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="smtp-port">Port</label>
          <input type="number" id="smtp-port" value="587">
        </div>
        <div class="form-group">
          <label for="smtp-secure">Security</label>
          <select id="smtp-secure">
            <option value="false">STARTTLS</option>
            <option value="true">SSL/TLS</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="smtp-user">Username</label>
        <input type="text" id="smtp-user" placeholder="your-email@gmail.com">
      </div>
      <div class="form-group">
        <label for="smtp-pass">Password</label>
        <input type="password" id="smtp-pass" placeholder="Your password or app password">
        <div class="help-text">For Gmail, use an App Password instead of your regular password</div>
      </div>
    </div>

    <!-- SendGrid Configuration -->
    <div class="config-form" id="sendgrid-config">
      <h3>SendGrid Configuration</h3>
      <div class="form-group">
        <label for="sendgrid-key">API Key</label>
        <input type="password" id="sendgrid-key" placeholder="SG.xxxxxx">
        <div class="help-text">Your SendGrid API key</div>
      </div>
    </div>

    <!-- Mailgun Configuration -->
    <div class="config-form" id="mailgun-config">
      <h3>Mailgun Configuration</h3>
      <div class="form-group">
        <label for="mailgun-key">API Key</label>
        <input type="password" id="mailgun-key" placeholder="key-xxxxxx">
      </div>
      <div class="form-group">
        <label for="mailgun-domain">Domain</label>
        <input type="text" id="mailgun-domain" placeholder="mg.yourdomain.com">
      </div>
    </div>

    <!-- Resend Configuration -->
    <div class="config-form" id="resend-config">
      <h3>Resend Configuration</h3>
      <div class="form-group">
        <label for="resend-key">API Key</label>
        <input type="password" id="resend-key" placeholder="re_xxxxxx">
        <div class="help-text">Your Resend API key</div>
      </div>
    </div>

    <!-- Common Settings -->
    <div id="common-settings" style="display: none;">
      <h3>Email Settings</h3>
      <div class="form-group">
        <label for="from-email">From Email</label>
        <input type="email" id="from-email" placeholder="noreply@yourdomain.com">
        <div class="help-text">The email address that will send OTP codes</div>
      </div>
      <div class="form-group">
        <label for="from-name">From Name</label>
        <input type="text" id="from-name" value="Browzer" placeholder="Browzer">
        <div class="help-text">The name that will appear in emails</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn btn-test" onclick="testConfiguration()">Test Configuration</button>
      <button class="btn btn-primary" onclick="saveConfiguration()">Save Configuration</button>
      <button class="btn btn-secondary" onclick="window.close()">Cancel</button>
    </div>

    <div id="status-message"></div>
  </div>

  <script>
    let selectedProvider = null;

    // Provider selection
    document.querySelectorAll('.provider-option').forEach(option => {
      option.addEventListener('click', () => {
        // Remove previous selection
        document.querySelectorAll('.provider-option').forEach(opt => opt.classList.remove('selected'));
        document.querySelectorAll('.config-form').forEach(form => form.classList.remove('active'));
        
        // Select new provider
        option.classList.add('selected');
        selectedProvider = option.dataset.provider;
        
        // Show corresponding form
        const form = document.getElementById(`${selectedProvider}-config`);
        if (form) {
          form.classList.add('active');
        }
        
        // Show common settings
        document.getElementById('common-settings').style.display = 'block';
      });
    });

    function showStatus(message, type) {
      const statusDiv = document.getElementById('status-message');
      statusDiv.textContent = message;
      statusDiv.className = `status-message ${type}`;
      statusDiv.style.display = 'block';
      
      if (type === 'success') {
        setTimeout(() => {
          statusDiv.style.display = 'none';
        }, 3000);
      }
    }

    async function testConfiguration() {
      if (!selectedProvider) {
        showStatus('Please select an email provider first', 'error');
        return;
      }

      const config = getConfigurationData();
      if (!config) return;

      try {
        const result = await window.electronAPI.ipcInvoke('test-email-config');
        if (result.success) {
          showStatus('Configuration test successful!', 'success');
        } else {
          showStatus(result.message || 'Configuration test failed', 'error');
        }
      } catch (error) {
        showStatus('Failed to test configuration', 'error');
      }
    }

    async function saveConfiguration() {
      if (!selectedProvider) {
        showStatus('Please select an email provider first', 'error');
        return;
      }

      const config = getConfigurationData();
      if (!config) return;

      try {
        const result = await window.electronAPI.ipcInvoke('configure-email-service', config);
        if (result.success) {
          showStatus('Configuration saved successfully!', 'success');
          setTimeout(() => {
            window.close();
          }, 2000);
        } else {
          showStatus(result.message || 'Failed to save configuration', 'error');
        }
      } catch (error) {
        showStatus('Failed to save configuration', 'error');
      }
    }

    function getConfigurationData() {
      const fromEmail = document.getElementById('from-email').value;
      const fromName = document.getElementById('from-name').value;

      if (!fromEmail) {
        showStatus('Please enter a from email address', 'error');
        return null;
      }

      const config = {
        provider: selectedProvider,
        from: fromEmail,
        fromName: fromName || 'Browzer'
      };

      switch (selectedProvider) {
        case 'smtp':
          const host = document.getElementById('smtp-host').value;
          const port = parseInt(document.getElementById('smtp-port').value);
          const secure = document.getElementById('smtp-secure').value === 'true';
          const user = document.getElementById('smtp-user').value;
          const pass = document.getElementById('smtp-pass').value;

          if (!host || !port || !user || !pass) {
            showStatus('Please fill in all SMTP fields', 'error');
            return null;
          }

          config.smtp = { host, port, secure, auth: { user, pass } };
          break;

        case 'sendgrid':
          const sgKey = document.getElementById('sendgrid-key').value;
          if (!sgKey) {
            showStatus('Please enter your SendGrid API key', 'error');
            return null;
          }
          config.apiKey = sgKey;
          break;

        case 'mailgun':
          const mgKey = document.getElementById('mailgun-key').value;
          const mgDomain = document.getElementById('mailgun-domain').value;
          if (!mgKey || !mgDomain) {
            showStatus('Please fill in all Mailgun fields', 'error');
            return null;
          }
          config.apiKey = mgKey;
          config.domain = mgDomain;
          break;

        case 'resend':
          const resendKey = document.getElementById('resend-key').value;
          if (!resendKey) {
            showStatus('Please enter your Resend API key', 'error');
            return null;
          }
          config.apiKey = resendKey;
          break;
      }

      return config;
    }

    // Load existing configuration on page load
    window.addEventListener('load', async () => {
      // You could add logic here to load existing configuration if needed
    });
  </script>
</body>
</html>
